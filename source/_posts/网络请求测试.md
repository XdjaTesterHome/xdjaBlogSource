---
title: 网络请求测试
date: 2016-10-31 09:48:58
tags: 流量请求 耗流量 网络请求 客户端性能
categories: 实例分析
---

        目前的网络类型包含2G\3G\4G\wifi，其中还有不同运营商的区分，我们在APP的使用中经常遇到大资源，重复请求，调用响应慢，调用失败等各种情况。在不同的网络类型之下，我们不仅要控制流量使用，还需要加快请求的响应。

1.1 流量

       通常来说APP流量使用最大的两部分是: 服务端api交互，图片/css/js等cdn静态资源。减少这两个部分的资源个数和资源大小，能有效的限制流量的使用。另外还需要严格控制后台静默时流量的使用。

1.2 流量统计工具

    DDMS Network Statistics、Android studio monitor

    3款代理工具: fiddler, charles, wmock

    抓包工具 : tcpdump

1.3 弱网络模拟&网络切换测试

        使用 charles throttle settings模拟，能够对上下行带宽，丢包率，延迟等网络参数进行设置


----------
关于弱网以及网络切换测试作为app功能/场测测试的一部分，所以在客户端网络请求性能测试上不在涉及，上面之所以把它拿出来，是想告诉大家我们测试APP软件的过程中思路不要太过局限。
        1、APP网络专项测试过程中：我们测试的范围只是包括应用后台情况下的静置耗流量测试，需对比同类应用相同环境下做对比测试；网络数据包请求测试。
        （1）、静置耗流量测试，用于测试静默状态下的流量消耗，已经在后台使用过程中的业务操作，重点着眼于无业务情况下的流量消耗，确定是否有无效业务偷流量，耗费系统资源。因此，如果静置耗流量比较高，一定是业务请求出了问题，所以静置耗流量属于网络数据包请求测试的一种场景，只不过它测试的是一段时间内的业务量。
        （2）网络请求测试的重点：
                 1.无重复请求，无重复下载(图片) 
                 2.常用切换界面需要做缓存 
                 3.支持分页加载 
例如流量测试可能出现以下类型的BUG:
![batterystats](/upload/image/data-model.jpg)

----------
举例分析其中一种情况：如测试客户端过程中，重复发出多次请求：
1、我们可以通过抓包软件fidder进行测试，当我们每操作一步APP的某个功能的时候，可以发现fiddler发出相同请求的个数，并通过收到服务端数据包的个数，以及数据包的类型是否相同来进行判断业务是否有重复的请求，如果有，就是存在问题，应该尽量避免有多余无效的应用请求。
2、我们也可以通过Android studio monitor来进行测试，当然测试过程中需要配合实时的logcat获取应用执行过程中的log，因为通过log也能看到应用发送和接受的数据，当然这没有fiddler的数据包更直观。
在执行测试app的每个业务场景的时候，实时抓取操作该动作前后，应用消耗的流量（上传和下载的流量综合），从而宏观的了解到应用操作该业务所消耗的流量，在测试每个场景网络请求的过程中，配合采集的流量数据，可以进行下一版本的横向比较，通过横向比较在无重复网络请求的情况下，我们可以知道版本质量的性能变化趋势。

小结：app网络流量性能测试点和测试范围：

 1.后台无操作情况下静置流量消耗（用于测试静默业务下的流量消耗），输出结果为静默状态下的一个流量消耗的值，用于版本横向比较，与其他应用进行比较，出现过高流量消耗时，需要抓取log进行分析。
 2、测试应用在前台各个操作场景下的网络请求次数、无效请求、重复请求次数。
 3、测试应用在前台各个操作场景下的每一类操作下的流量消耗的值，（可多次测试记录消耗平均值、波动范围等参数，用于优化和分析调优，也用于版本横向比较），关于本部分每部操作下流量消耗总量的统计、绘图及分析方法可以通过Python脚本实现。因为现有测试工具Android studio monitor 实现的数据流量实时监控，但不会采集数据并保存我们需要的数据。